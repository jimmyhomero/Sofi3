/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package Vista.dasboard;

import Controlador.Usuarios.ClientesDao;
import Controlador.Usuarios.FacturasDao;
import Controlador.Usuarios.HoraFecha;
import Modelo.Facturas;
import Modelo.nube.Clientes;
import Vista.alertas.alerta;
import java.awt.image.BufferedImage;
import java.util.ArrayList;
import java.util.Date;
import javax.swing.ImageIcon;
import javax.swing.JOptionPane;
import org.jfree.chart.ChartFactory;
import org.jfree.chart.JFreeChart;
import org.jfree.chart.plot.PlotOrientation;
import org.jfree.data.category.DefaultCategoryDataset;
import org.jfree.data.general.DefaultPieDataset;

/**
 *
 * @author USUARIO
 */
public class dash extends javax.swing.JInternalFrame {

    /**
     * Creates new form dash
     */
    public Integer tipografica=0;
    public dash() {
        initComponents();
        setFechayHoraActualJDChooser();
        jComboBox2.setSelectedItem("barras");
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        jPanelx1 = new javax.swing.JPanel();
        jLabelx1 = new javax.swing.JLabel();
        jPanel2 = new javax.swing.JPanel();
        jPanel3 = new javax.swing.JPanel();
        jdchoserdesde = new com.toedter.calendar.JDateChooser();
        btn_hoy = new javax.swing.JButton();
        jdchoserhasta = new com.toedter.calendar.JDateChooser();
        jLabel5 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        btn_buscar = new javax.swing.JButton();
        jComboBox1 = new javax.swing.JComboBox<>();
        jComboBox2 = new javax.swing.JComboBox<>();

        setClosable(true);
        setResizable(true);
        addInternalFrameListener(new javax.swing.event.InternalFrameListener() {
            public void internalFrameActivated(javax.swing.event.InternalFrameEvent evt) {
            }
            public void internalFrameClosed(javax.swing.event.InternalFrameEvent evt) {
            }
            public void internalFrameClosing(javax.swing.event.InternalFrameEvent evt) {
            }
            public void internalFrameDeactivated(javax.swing.event.InternalFrameEvent evt) {
            }
            public void internalFrameDeiconified(javax.swing.event.InternalFrameEvent evt) {
            }
            public void internalFrameIconified(javax.swing.event.InternalFrameEvent evt) {
            }
            public void internalFrameOpened(javax.swing.event.InternalFrameEvent evt) {
                formInternalFrameOpened(evt);
            }
        });

        jPanelx1.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        jLabelx1.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jLabelx1MouseClicked(evt);
            }
        });

        javax.swing.GroupLayout jPanelx1Layout = new javax.swing.GroupLayout(jPanelx1);
        jPanelx1.setLayout(jPanelx1Layout);
        jPanelx1Layout.setHorizontalGroup(
            jPanelx1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanelx1Layout.createSequentialGroup()
                .addComponent(jLabelx1, javax.swing.GroupLayout.PREFERRED_SIZE, 1429, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, Short.MAX_VALUE))
        );
        jPanelx1Layout.setVerticalGroup(
            jPanelx1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jLabelx1, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 462, Short.MAX_VALUE)
        );

        jPanel2.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        jPanel3.setBorder(javax.swing.BorderFactory.createTitledBorder("Fechas"));

        jdchoserdesde.setDateFormatString("yyyy-MM-dd");
        jdchoserdesde.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jdchoserdesdeMouseClicked(evt);
            }
        });

        btn_hoy.setText("HOY");
        btn_hoy.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_hoyActionPerformed(evt);
            }
        });

        jdchoserhasta.setDateFormatString("yyyy-MM-dd");

        jLabel5.setText("Hasta:");

        jLabel4.setText("Desde:");

        btn_buscar.setText("Buscar");
        btn_buscar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_buscarActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel3Layout = new javax.swing.GroupLayout(jPanel3);
        jPanel3.setLayout(jPanel3Layout);
        jPanel3Layout.setHorizontalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 282, Short.MAX_VALUE)
            .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(jPanel3Layout.createSequentialGroup()
                    .addGap(0, 0, Short.MAX_VALUE)
                    .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addComponent(jLabel4)
                        .addGroup(jPanel3Layout.createSequentialGroup()
                            .addComponent(jdchoserdesde, javax.swing.GroupLayout.PREFERRED_SIZE, 190, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addGap(10, 10, 10)
                            .addComponent(btn_hoy, javax.swing.GroupLayout.PREFERRED_SIZE, 82, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGroup(jPanel3Layout.createSequentialGroup()
                            .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                .addComponent(jLabel5)
                                .addComponent(jdchoserhasta, javax.swing.GroupLayout.PREFERRED_SIZE, 190, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGap(10, 10, 10)
                            .addComponent(btn_buscar, javax.swing.GroupLayout.PREFERRED_SIZE, 82, javax.swing.GroupLayout.PREFERRED_SIZE)))
                    .addGap(0, 0, Short.MAX_VALUE)))
        );
        jPanel3Layout.setVerticalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 100, Short.MAX_VALUE)
            .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(jPanel3Layout.createSequentialGroup()
                    .addGap(0, 0, Short.MAX_VALUE)
                    .addComponent(jLabel4)
                    .addGap(4, 4, 4)
                    .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addComponent(jdchoserdesde, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(btn_hoy))
                    .addGap(5, 5, 5)
                    .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(jPanel3Layout.createSequentialGroup()
                            .addComponent(jLabel5)
                            .addGap(4, 4, 4)
                            .addComponent(jdchoserhasta, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGroup(jPanel3Layout.createSequentialGroup()
                            .addGap(10, 10, 10)
                            .addComponent(btn_buscar, javax.swing.GroupLayout.PREFERRED_SIZE, 38, javax.swing.GroupLayout.PREFERRED_SIZE)))
                    .addGap(0, 0, Short.MAX_VALUE)))
        );

        jComboBox1.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "FACTURAS", "TICKETS", "PROFORMAS" }));
        jComboBox1.addItemListener(new java.awt.event.ItemListener() {
            public void itemStateChanged(java.awt.event.ItemEvent evt) {
                jComboBox1ItemStateChanged(evt);
            }
        });

        jComboBox2.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Seleccione", "Barras", "Pastel" }));
        jComboBox2.addItemListener(new java.awt.event.ItemListener() {
            public void itemStateChanged(java.awt.event.ItemEvent evt) {
                jComboBox2ItemStateChanged(evt);
            }
        });

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addComponent(jPanel3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(jComboBox1, 0, 152, Short.MAX_VALUE)
                    .addComponent(jComboBox2, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addGap(0, 0, Short.MAX_VALUE))
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel2Layout.createSequentialGroup()
                .addGap(0, 0, Short.MAX_VALUE)
                .addComponent(jPanel3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jComboBox1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jComboBox2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                    .addComponent(jPanel2, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jPanelx1, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addGap(0, 0, Short.MAX_VALUE))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, 0)
                .addComponent(jPanelx1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, Short.MAX_VALUE))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void jLabelx1MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jLabelx1MouseClicked
        // TODO add your handling code here:

    }//GEN-LAST:event_jLabelx1MouseClicked
    private void setFechayHoraActualJDChooser() {
        HoraFecha ob = new HoraFecha();
        ob.getHoraActualmyMachine();
        Date inicio = ob.fechaActual_00_00_00();
        Date fin = ob.fechaActual_23_59_59();
        jdchoserdesde.setDate(inicio);
        jdchoserhasta.setDate(fin);

    }
    private void graficaVentasXfecha(Integer tipo){
        ArrayList<Facturas> listafac = new ArrayList<Facturas>();
        String fechaInicio = HoraFecha.fecha_aa_mm_dd_HH_mm_ss(jdchoserdesde.getDate().toString());
        String fechaFIn = HoraFecha.fecha_aa_mm_dd_HH_mm_ss(jdchoserhasta.getDate().toString());
        FacturasDao fdao = new FacturasDao();
        listafac = fdao.ListaVentasportipoyFacha(fechaInicio, fechaFIn);        
        if(tipo==1){
        DefaultPieDataset porciones;
        JFreeChart torta;
        porciones = new DefaultPieDataset();
        Double total = 0.0;
        for (Facturas f : listafac) {
            if (f.getTipo_documento().equalsIgnoreCase("FACTURA")) {

                total = total + (Double.parseDouble(f.getSubtotaI_con_iva()) + Double.parseDouble(f.getSubtotal_sin_iva()));
                porciones.setValue(f.getTipo_documento(), total);                
            }
            if (f.getTipo_documento().equalsIgnoreCase("ticket")) {

                total = total + (Double.parseDouble(f.getSubtotaI_con_iva()) + Double.parseDouble(f.getSubtotal_sin_iva()));
                porciones.setValue(f.getTipo_documento(), total);
            }
            if (f.getTipo_documento().equalsIgnoreCase("proforma")) {

                total = total + (Double.parseDouble(f.getSubtotaI_con_iva()) + Double.parseDouble(f.getSubtotal_sin_iva()));
                porciones.setValue(f.getTipo_documento(), total);
            }

        }
        torta = ChartFactory.createPieChart3D("Grafica de Ventas", porciones, true, true, false);
        BufferedImage graficoTorta = torta.createBufferedImage(jPanelx1.getWidth(), jPanelx1.getHeight());
        jLabelx1.setSize(jPanelx1.getSize());
        jLabelx1.setIcon(new ImageIcon(graficoTorta));
        jPanelx1.updateUI();
        }else if(tipo==2){
        JFreeChart barra = null;
        DefaultCategoryDataset datos;
        datos = new DefaultCategoryDataset();
        Double total = 0.0;
        for (Facturas f : listafac) {
            if (f.getTipo_documento().equalsIgnoreCase("FACTURA")) {

                total = total + (Double.parseDouble(f.getSubtotaI_con_iva()) + Double.parseDouble(f.getSubtotal_sin_iva()));
                datos.setValue(total,f.getTipo_documento(),"");                
            }
            if (f.getTipo_documento().equalsIgnoreCase("ticket")) {

                total = total + (Double.parseDouble(f.getSubtotaI_con_iva()) + Double.parseDouble(f.getSubtotal_sin_iva()));
                datos.setValue(total,f.getTipo_documento(),"");                
            }
            if (f.getTipo_documento().equalsIgnoreCase("proforma")) {

                total = total + (Double.parseDouble(f.getSubtotaI_con_iva()) + Double.parseDouble(f.getSubtotal_sin_iva()));
                datos.setValue(total,f.getTipo_documento(),"");                
            }

        }        
        barra = ChartFactory.createBarChart3D("Grafica de Ventas", "Tipos Documentos", "Total Ventas", datos, PlotOrientation.VERTICAL, true, true, true);
        BufferedImage graficoBarra = barra.createBufferedImage(jPanelx1.getWidth(), jPanelx1.getHeight());

        jLabelx1.setSize(jPanelx1.getSize());
        jLabelx1.setIcon(new ImageIcon(graficoBarra));

        jPanelx1.updateUI();
        }else if(tipografica==3){
        JFreeChart barra = null;
        DefaultCategoryDataset datos;
        datos = new DefaultCategoryDataset();
        Double total = 0.0;
        for (Facturas f : listafac) {
            if (f.getTipo_documento().equalsIgnoreCase("FACTURA")) {
                f.getClientes_codigo();
                
                total = total + (Double.parseDouble(f.getSubtotaI_con_iva()) + Double.parseDouble(f.getSubtotal_sin_iva()));
                datos.setValue(total,f.getTipo_documento(),"");                
            }
            if (f.getTipo_documento().equalsIgnoreCase("ticket")) {

                total = total + (Double.parseDouble(f.getSubtotaI_con_iva()) + Double.parseDouble(f.getSubtotal_sin_iva()));
                datos.setValue(total,f.getTipo_documento(),"");                
            }
            if (f.getTipo_documento().equalsIgnoreCase("proforma")) {

                total = total + (Double.parseDouble(f.getSubtotaI_con_iva()) + Double.parseDouble(f.getSubtotal_sin_iva()));
                datos.setValue(total,f.getTipo_documento(),"");                
            }

        }        
        barra = ChartFactory.createBarChart3D("Grafica de Ventas", "Tipos Documentos", "Total Ventas", datos, PlotOrientation.VERTICAL, true, true, true);
        BufferedImage graficoBarra = barra.createBufferedImage(jPanelx1.getWidth(), jPanelx1.getHeight());

        jLabelx1.setSize(jPanelx1.getSize());
        jLabelx1.setIcon(new ImageIcon(graficoBarra));

        jPanelx1.updateUI();
        }
        
    }
    private void formInternalFrameOpened(javax.swing.event.InternalFrameEvent evt) {//GEN-FIRST:event_formInternalFrameOpened
        // TODO add your handling code here:
        tipografica=2;
        graficaVentasXfecha(tipografica);
        
//        //////////////////////////////////// BARRAS
//

    }//GEN-LAST:event_formInternalFrameOpened

    private void jdchoserdesdeMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jdchoserdesdeMouseClicked
        // TODO add your handling code here:
        //jdchoserdesde
    }//GEN-LAST:event_jdchoserdesdeMouseClicked

    private void btn_hoyActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_hoyActionPerformed
        // TODO add your handling code here:
        setFechayHoraActualJDChooser();
        FacturasDao obj = new FacturasDao();
        String fechaInicio = HoraFecha.fecha_aa_mm_dd_HH_mm_ss(jdchoserdesde.getDate().toString());
        String fechaFIn = HoraFecha.fecha_aa_mm_dd_HH_mm_ss(jdchoserhasta.getDate().toString());
        graficaVentasXfecha(tipografica);
        //jTable1.setModel(obj.listarFacturasTbModel(fechaInicio, fechaFIn, tipo_doc_seleccionado));
        //this.ocultarFIlasJtable();
    }//GEN-LAST:event_btn_hoyActionPerformed

    private void btn_buscarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_buscarActionPerformed
        // TODO add your handling code here:
        if (jdchoserdesde.getDate().before(jdchoserhasta.getDate())) {

            //FacturasDao obj = new FacturasDao();
            String fechaInicio = HoraFecha.fecha_aa_mm_dd_HH_mm_ss(jdchoserdesde.getDate().toString());
            String fechaFIn = HoraFecha.fecha_aa_mm_dd_HH_mm_ss(jdchoserhasta.getDate().toString());
            graficaVentasXfecha(tipografica);
        } else {
            alerta.menajes("Ranngo Errado!! Fecha de Inicio es Mayor a la del Final...");
        }
    }//GEN-LAST:event_btn_buscarActionPerformed

    private void jComboBox1ItemStateChanged(java.awt.event.ItemEvent evt) {//GEN-FIRST:event_jComboBox1ItemStateChanged
        // TODO add your handling code here:
        String fechaInicio = HoraFecha.fecha_aa_mm_dd_HH_mm_ss(jdchoserdesde.getDate().toString());
        String fechaFIn = HoraFecha.fecha_aa_mm_dd_HH_mm_ss(jdchoserhasta.getDate().toString());
    }//GEN-LAST:event_jComboBox1ItemStateChanged

    private void jComboBox2ItemStateChanged(java.awt.event.ItemEvent evt) {//GEN-FIRST:event_jComboBox2ItemStateChanged
        // TODO add your handling code here:
        if(jComboBox2.getSelectedItem().toString().equalsIgnoreCase("barras")){
        tipografica=2;    
         graficaVentasXfecha(tipografica);
        }else if(jComboBox2.getSelectedItem().toString().equalsIgnoreCase("Pastel")){
        tipografica=1;
         graficaVentasXfecha(tipografica);
        }else{
            JOptionPane.showMessageDialog(null, "Seleccione tipo de Graficas");
        }
        
    }//GEN-LAST:event_jComboBox2ItemStateChanged


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btn_buscar;
    private javax.swing.JButton btn_hoy;
    private javax.swing.JComboBox<String> jComboBox1;
    private javax.swing.JComboBox<String> jComboBox2;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabelx1;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanelx1;
    private com.toedter.calendar.JDateChooser jdchoserdesde;
    private com.toedter.calendar.JDateChooser jdchoserhasta;
    // End of variables declaration//GEN-END:variables
}
